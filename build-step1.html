<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Basic Information - LessonBuilders</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--navy:#0D2847;--orange:#FF8C42;--orange2:#FFB380;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:linear-gradient(135deg,#F7FAFC 0%,#FFF 100%);color:#0D2847;}
.top-nav{background:white;border-bottom:2px solid rgba(13,40,71,0.1);padding:16px 40px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.nav-left{display:flex;align-items:center;gap:40px;}
.logo-text{font-family:'Crimson Pro',serif;font-size:24px;font-weight:700;color:var(--navy);text-decoration:none;}
.nav-menu{display:flex;gap:32px;align-items:center;}
.nav-link{text-decoration:none;color:#4A5568;font-weight:500;font-size:15px;transition:color 0.2s;}
.nav-link:hover{color:var(--navy);}
.nav-right{display:flex;align-items:center;gap:16px;}
.user-profile{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--orange),#FFB380);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:14px;cursor:pointer;}
.container{display:flex;max-width:1400px;margin:0 auto;}
.sidebar{width:280px;background:white;border-right:1px solid rgba(13,40,71,0.1);padding:24px 18px;position:relative;}
.nav-step{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;transition:all 0.2s;border-left:3px solid transparent;text-decoration:none;color:#4A5568;}
.nav-step.active{background:rgba(255,140,66,0.1);border-left-color:var(--orange);color:var(--navy);font-weight:600;}
.step-number{width:28px;height:28px;border-radius:50%;background:#F7FAFC;border:2px solid #E2E8F0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;color:#999;}
.nav-step.active .step-number{background:var(--orange);border-color:var(--orange);color:white;}
.main-content{flex:1;padding:40px 60px;max-width:900px;}
.page-title{font-family:'Crimson Pro',serif;font-size:42px;font-weight:700;margin-bottom:12px;color:var(--navy);}
.page-subtitle{font-size:18px;color:#4A5568;margin-bottom:26px;}
.progress-bar{height:6px;background:#E2E8F0;border-radius:3px;margin-bottom:28px;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--orange),#FFB380);border-radius:3px;}
.form-group{margin-bottom:22px;}
.form-label{display:block;font-weight:600;margin-bottom:8px;color:var(--navy);font-size:15px;}
.form-input,.form-select,.form-textarea{width:100%;padding:12px 16px;border:2px solid #E2E8F0;border-radius:10px;font-size:15px;font-family:'DM Sans',sans-serif;transition:all 0.2s;background:white;}
.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--orange);}
.form-textarea{resize:vertical;min-height:92px;}
.slider{width:100%;height:8px;border-radius:4px;background:#E2E8F0;appearance:none;cursor:pointer;}
.slider::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:var(--orange);cursor:pointer;}
.slider-value{text-align:center;margin-top:8px;font-weight:600;color:var(--navy);}
.btn{padding:14px 28px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.3s;text-decoration:none;display:inline-block;border:none;}
.btn-primary{background:linear-gradient(135deg,var(--orange),#FFB380);color:white;}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,140,66,0.4);}
.btn-secondary{background:white;border:2px solid #E2E8F0;color:var(--navy);}
.btn-secondary:hover{border-color:var(--orange);}
.btn-group{display:flex;justify-content:space-between;margin-top:34px;gap:12px;}
.optional-section{background:rgba(255,140,66,0.05);border:2px dashed rgba(255,140,66,0.3);border-radius:12px;padding:20px;margin:26px 0;transition:all 0.3s;}
.optional-section:hover{background:rgba(255,140,66,0.1);}
.optional-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;}
.optional-title{font-weight:600;color:var(--navy);font-size:16px;}
.optional-icon{font-size:20px;transition:transform 0.3s;}
.optional-icon.expanded{transform:rotate(180deg);}
.optional-content{max-height:0;overflow:hidden;transition:max-height 0.3s;}
.optional-content.show{max-height:1200px;margin-top:22px;}

.insp-wrap{position:sticky;top:92px;margin-bottom:18px;}
.insp-toggle{
  width:100%;
  display:flex;align-items:center;justify-content:space-between;
  border:2px solid #E2E8F0;background:#fff;border-radius:12px;padding:10px 12px;
  cursor:pointer;user-select:none;
}
.insp-toggle .left{display:flex;align-items:center;gap:10px;}
.insp-pill{
  font-size:12px;font-weight:800;letter-spacing:.7px;text-transform:uppercase;color:var(--navy);
}
.insp-count{
  font-size:12px;font-weight:800;background:rgba(255,140,66,0.12);
  color:var(--navy);padding:3px 8px;border-radius:999px;min-width:24px;text-align:center;
}
.insp-caret{font-size:12px;transition:transform .2s;}
.insp-caret.open{transform:rotate(180deg);}
.insp-panel{
  display:none;
  background:#fff;border:2px solid #E2E8F0;border-radius:14px;
  padding:14px;margin-top:10px;
}
.insp-panel.open{display:block;}
.dropzone{
  border:2px dashed rgba(13,40,71,0.25);
  border-radius:12px;
  padding:12px;
  text-align:center;
  color:#4A5568;
  background:rgba(13,40,71,0.02);
  font-size:13px;
}
.dropzone.dragover{border-color:var(--orange);background:rgba(255,140,66,0.08);}
.insp-btnrow{display:flex;gap:10px;margin-top:10px;}
.insp-btn{flex:1;padding:10px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;}
.insp-browse{background:linear-gradient(135deg,var(--orange),#FFB380);color:#fff;}
.insp-clear{background:#fff;border:2px solid #E2E8F0;color:var(--navy);}
.insp-clear:hover{border-color:var(--orange);}
.file-list{margin-top:10px;display:grid;gap:8px;}
.file-item{border:2px solid #E2E8F0;border-radius:10px;padding:10px;display:flex;align-items:center;justify-content:space-between;gap:10px;}
.file-meta{display:flex;flex-direction:column;gap:2px;min-width:0;}
.file-name{font-weight:700;color:var(--navy);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:155px;}
.file-sub{font-size:12px;color:#718096;}
.file-remove{padding:8px 10px;border-radius:10px;border:2px solid #E2E8F0;background:#fff;color:var(--navy);font-weight:700;cursor:pointer;}
.file-remove:hover{border-color:var(--orange);}
.insp-help{font-size:12px;color:#718096;margin-top:10px;line-height:1.35;}
.insp-required{font-size:12px;color:#A94442;margin-top:8px;display:none;}
</style>
</head>
<body>
<nav class="top-nav">
  <div class="nav-left">
    <a href="index.html" class="logo-text">LessonBuilders</a>
    <div class="nav-menu">
      <a href="library.html" class="nav-link">My Lessons</a>
      <a href="discover.html" class="nav-link">Discover</a>
      <a href="about.html" class="nav-link">Help</a>
    </div>
  </div>
  <div class="nav-right"><div class="user-profile">JD</div></div>
</nav>

<div class="container">
  <aside class="sidebar">
    <div class="insp-wrap">
      <div class="insp-toggle" id="inspToggle" aria-expanded="false">
        <div class="left">
          <div class="insp-pill">INSPIRATION UPLOADS</div>
          <div class="insp-count" id="inspCount">0</div>
        </div>
        <div class="insp-caret" id="inspCaret">▼</div>
      </div>

      <div class="insp-panel" id="inspPanel">
        <div class="dropzone" id="dropzone">
          Drag &amp; drop a PDF, DOC, or image<br>
          or click “Browse Files”
        </div>

        <div class="insp-btnrow">
          <button class="insp-btn insp-browse" type="button" id="browseBtn">Browse Files</button>
          <button class="insp-btn insp-clear" type="button" id="clearBtn">Clear</button>
        </div>

        <input type="file" id="fileInput" multiple style="display:none" accept=".pdf,.doc,.docx,image/*"/>

        <div class="file-list" id="fileList"></div>

        <div class="form-group" style="margin-top:12px;">
          <label class="form-label" style="font-size:14px;">What do you see in the file?</label>
          <textarea class="form-textarea" id="inspirationObserved" placeholder="Describe what’s in the image/doc (people, objects, setting, labels, etc.)."></textarea>
          <div class="insp-required" id="reqObserved">Required when you upload a file so the lesson can be built around it.</div>
        </div>

        <div class="form-group">
          <label class="form-label" style="font-size:14px;">What should students learn from it?</label>
          <textarea class="form-textarea" id="inspirationGoal" placeholder="What should students learn or do because of this inspiration?"></textarea>
          <div class="insp-required" id="reqGoal">Required when you upload a file so the lesson can be built around it.</div>
        </div>

        <div class="form-group">
          <label class="form-label" style="font-size:14px;">What do you want to focus on?</label>
          <textarea class="form-textarea" id="inspirationNotes" placeholder="Example: Keep the same hook, but simplify the assessment."></textarea>
        </div>

        <div class="insp-help">Stored locally for this lesson build, deleted after lesson save/export</div>
      </div>
    </div>

    <div style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:#999;margin:10px 0 16px;">BUILD LESSON</div>
    <a href="build-step1.html" class="nav-step active"><div class="step-number">1</div><div>Basic Information</div></a>
    <a href="build-step2.html" class="nav-step"><div class="step-number">2</div><div>Teaching Style</div></a>
    <a href="build-step3.html" class="nav-step"><div class="step-number">3</div><div>Choose Template</div></a>
    <a href="build-step4.html" class="nav-step"><div class="step-number">4</div><div>Build Method</div></a>
    <a href="build-step5.html" class="nav-step"><div class="step-number">5</div><div>Assessments</div></a>
    <a href="build-step6.html" class="nav-step"><div class="step-number">6</div><div>Preview & Export</div></a>
    <a href="build-step7.html" class="nav-step"><div class="step-number">7</div><div>Collaborate</div></a>
  </aside>

  <main class="main-content">
    <h1 class="page-title">Tell us what you need</h1>
    <p class="page-subtitle">We&apos;ll align it to California standards</p>
    <div class="progress-bar"><div class="progress-fill" style="width:12%;"></div></div>

    <div class="form-group">
      <label class="form-label">Grade Level</label>
      <select class="form-select" id="gradeSelect">
        <option>Kindergarten</option><option>1st Grade</option><option>2nd Grade</option><option>3rd Grade</option>
        <option>4th Grade</option><option selected>5th Grade</option><option>6th Grade</option><option>7th Grade</option>
        <option>8th Grade</option><option>9th Grade</option><option>10th Grade</option><option>11th Grade</option><option>12th Grade</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Subject</label>
      <select class="form-select" id="subjectSelect">
        <option selected>Mathematics</option>
        <option>English Language Arts (ELA)</option>
        <option>Science</option>
        <option>Social Studies / History</option>
        <option>Physical Education</option>
        <option>Arts</option>
        <option>Other</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Lesson Topic</label>
      <input type="text" class="form-input" id="topicInput" placeholder="Example: Introduction to fractions">
    </div>

    <div class="form-group">
      <label class="form-label">State</label>
      <select class="form-select" id="stateSelect">
        <option selected>California</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Lesson Duration</label>
      <input type="range" min="15" max="120" value="45" class="slider" id="durationSlider">
      <div class="slider-value" id="durationValue">45 minutes</div>
    </div>

    <div class="optional-section" id="optionalSection">
      <div class="optional-header" id="optionalHeader">
        <div class="optional-title">+ Additional Details (Optional)</div>
        <div class="optional-icon" id="optionalIcon">&#9660;</div>
      </div>
      <div class="optional-content" id="optionalContent">
        <div class="form-group">
          <label class="form-label">Class Size</label>
          <select class="form-select" id="classSizeSelect">
            <option>Small (1-15 students)</option>
            <option selected>Medium (16-25 students)</option>
            <option>Large (26-35 students)</option>
            <option>Very large (36+ students)</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">My students include (select all that apply)</label>
          <div style="display:grid;gap:8px;">
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb1"> English Language Learners</label>
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb2"> Students with IEPs</label>
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb3"> Students with 504 plans</label>
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb4"> Gifted/advanced learners</label>
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb5"> Below grade level</label>
            <label style="display:flex;align-items:center;gap:8px;"><input type="checkbox" id="cb6"> Mixed ability classroom</label>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Focus on specific standard (optional)</label>
          <input type="text" class="form-input" id="standardInput" placeholder="e.g., 5.NF.A.1">
          <div style="font-size:13px;color:#718096;margin-top:4px;">Leave blank to auto-select best standards</div>
        </div>

        <div class="form-group">
          <label class="form-label">Prior knowledge</label>
          <select class="form-select" id="priorKnowledgeSelect">
            <option>First time seeing this concept</option>
            <option selected>Have some background</option>
            <option>Review/reinforcement</option>
            <option>Advanced/extension</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Additional context</label>
          <textarea class="form-textarea" id="contextTextarea" rows="4" placeholder="Special needs, timing, classroom setup, etc."></textarea>
        </div>
      </div>
    </div>

    <div class="btn-group">
      <a href="index.html" class="btn btn-secondary">&larr; Back to Home</a>
      <button class="btn btn-primary" type="button" onclick="saveAndContinue()">Next: Teaching Style &rarr;</button>
    </div>
  </main>
</div>

<script>
/* ---------------- Inspiration Uploads (local only) ---------------- */
const MAX_FILES = 5;

const inspToggle = document.getElementById("inspToggle");
const inspPanel  = document.getElementById("inspPanel");
const inspCaret  = document.getElementById("inspCaret");
const inspCount  = document.getElementById("inspCount");

const dropzone   = document.getElementById("dropzone");
const browseBtn  = document.getElementById("browseBtn");
const clearBtn   = document.getElementById("clearBtn");
const fileInput  = document.getElementById("fileInput");
const fileList   = document.getElementById("fileList");

const inspirationObservedEl = document.getElementById("inspirationObserved");
const inspirationGoalEl     = document.getElementById("inspirationGoal");
const inspirationNotesEl    = document.getElementById("inspirationNotes");
const reqObservedEl         = document.getElementById("reqObserved");
const reqGoalEl             = document.getElementById("reqGoal");

let inspirationFiles = []; // { name, type, size, dataUrl? }

function openInspPanel(open){
  const isOpen = typeof open === "boolean" ? open : !inspPanel.classList.contains("open");
  inspPanel.classList.toggle("open", isOpen);
  inspCaret.classList.toggle("open", isOpen);
  inspToggle.setAttribute("aria-expanded", String(isOpen));
}
inspToggle.addEventListener("click", () => openInspPanel());

/* Start CLOSED every time */
openInspPanel(false);

function bytesToSize(bytes){
  const b = Number(bytes||0);
  if (b < 1024) return b + " B";
  const kb = b/1024;
  if (kb < 1024) return kb.toFixed(1) + " KB";
  const mb = kb/1024;
  return mb.toFixed(1) + " MB";
}

function renderFileList(){
  inspCount.textContent = String(inspirationFiles.length || 0);
  if (!inspirationFiles.length){
    fileList.innerHTML = `<div style="font-size:13px;color:#718096;margin-top:6px;">No files uploaded yet.</div>`;
    return;
  }
  fileList.innerHTML = inspirationFiles.map((f, idx) => `
    <div class="file-item">
      <div class="file-meta">
        <div class="file-name" title="${escapeHtml(f.name)}">${escapeHtml(f.name)}</div>
        <div class="file-sub">${escapeHtml((f.type||"").replace("application/",""))} • ${escapeHtml(bytesToSize(f.size))}</div>
      </div>
      <button type="button" class="file-remove" onclick="removeInspFile(${idx})">Remove</button>
    </div>
  `).join("");
}
function removeInspFile(idx){
  inspirationFiles.splice(idx,1);
  renderFileList();
  persistInspiration();
}
function clearInspAll(){
  inspirationFiles = [];
  if (inspirationObservedEl) inspirationObservedEl.value = "";
  if (inspirationGoalEl) inspirationGoalEl.value = "";
  if (inspirationNotesEl) inspirationNotesEl.value = "";
  hideRequiredHints();
  renderFileList();
  persistInspiration();
}

function hideRequiredHints(){
  if (reqObservedEl) reqObservedEl.style.display = "none";
  if (reqGoalEl) reqGoalEl.style.display = "none";
}
function showRequiredHints(){
  if (reqObservedEl) reqObservedEl.style.display = "block";
  if (reqGoalEl) reqGoalEl.style.display = "block";
}

function escapeHtml(str) {
  return String(str ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

browseBtn.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", (e) => {
  const files = Array.from(e.target.files || []);
  handleFiles(files);
  fileInput.value = "";
});
clearBtn.addEventListener("click", clearInspAll);

dropzone.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropzone.classList.add("dragover");
});
dropzone.addEventListener("dragleave", () => dropzone.classList.remove("dragover"));
dropzone.addEventListener("drop", (e) => {
  e.preventDefault();
  dropzone.classList.remove("dragover");
  const files = Array.from(e.dataTransfer.files || []);
  handleFiles(files);
});

function handleFiles(files){
  if (!files.length) return;
  const allowed = files.filter(f => {
    const name = (f.name||"").toLowerCase();
    return (
      name.endsWith(".pdf") || name.endsWith(".doc") || name.endsWith(".docx") ||
      (f.type || "").startsWith("image/")
    );
  });

  if (!allowed.length){
    alert("Please upload a PDF, DOC/DOCX, or an image file.");
    return;
  }

  const room = Math.max(0, MAX_FILES - inspirationFiles.length);
  const add = allowed.slice(0, room);
  if (!add.length){
    alert(`You can upload up to ${MAX_FILES} files.`);
    return;
  }

  add.forEach(f => {
    inspirationFiles.push({
      name: f.name || "file",
      type: f.type || "",
      size: f.size || 0
    });
  });

  renderFileList();
  persistInspiration();
}

/* Persist inspiration in lessonData.step1.inspiration */
function getInspiration(){
  return {
    files: inspirationFiles.map(f => ({ name:f.name, type:f.type, size:f.size })),
    observedDetails: (inspirationObservedEl?.value || "").trim(),
    learningGoal: (inspirationGoalEl?.value || "").trim(),
    notes: (inspirationNotesEl?.value || "").trim()
  };
}
function persistInspiration(){
  try{
    const saved = localStorage.getItem("lessonData");
    const data = saved ? JSON.parse(saved) : {};
    data.step1 = data.step1 || {};
    data.step1.inspiration = getInspiration();
    localStorage.setItem("lessonData", JSON.stringify(data));
  }catch(e){
    console.warn("persistInspiration failed:", e);
  }
}
function restoreInspiration(){
  try{
    const saved = localStorage.getItem("lessonData");
    if (!saved) { renderFileList(); return; }
    const data = JSON.parse(saved);
    const insp = data?.step1?.inspiration || null;
    if (!insp) { renderFileList(); return; }

    inspirationFiles = Array.isArray(insp.files) ? insp.files.map(f => ({
      name: String(f?.name||""),
      type: String(f?.type||""),
      size: Number(f?.size||0)
    })).filter(f => f.name) : [];

    if (inspirationNotesEl) inspirationNotesEl.value = insp?.notes || "";
    if (inspirationObservedEl) inspirationObservedEl.value = insp?.observedDetails || "";
    if (inspirationGoalEl) inspirationGoalEl.value = insp?.learningGoal || "";

    renderFileList();
  }catch(e){
    console.warn("restoreInspiration failed:", e);
    renderFileList();
  }
}

[inspirationObservedEl, inspirationGoalEl, inspirationNotesEl].forEach(el => {
  if (!el) return;
  el.addEventListener("input", () => persistInspiration());
});

/* ---------------- Existing Step 1 form restore/save ---------------- */
window.addEventListener('DOMContentLoaded', function() {
  const savedData = localStorage.getItem('lessonData');
  if (savedData) {
    const data = JSON.parse(savedData);
    if (data.step1) {
      document.getElementById('gradeSelect').value = data.step1.grade || '5th Grade';
      document.getElementById('subjectSelect').value = data.step1.subject || 'Mathematics';
      document.getElementById('topicInput').value = data.step1.topic || '';
      document.getElementById('stateSelect').value = data.step1.state || 'California';
      document.getElementById('durationSlider').value = data.step1.duration || 45;
      document.getElementById('durationValue').textContent = (data.step1.duration || 45) + ' minutes';

      if (data.step1.classSize) document.getElementById('classSizeSelect').value = data.step1.classSize;
      if (data.step1.standardFocus) document.getElementById('standardInput').value = data.step1.standardFocus;
      if (data.step1.priorKnowledge) document.getElementById('priorKnowledgeSelect').value = data.step1.priorKnowledge;
      if (data.step1.additionalContext) document.getElementById('contextTextarea').value = data.step1.additionalContext;

      if (data.step1.studentNeeds) {
        for (let i = 0; i < 6; i++) {
          const cb = document.getElementById('cb' + (i+1));
          if (cb && data.step1.studentNeeds[i]) cb.checked = true;
        }
      }
    }
  }

  restoreInspiration();
});

function saveAndContinue() {
  const grade = document.getElementById('gradeSelect').value;
  const subject = document.getElementById('subjectSelect').value;
  const topic = document.getElementById('topicInput').value;
  const state = document.getElementById('stateSelect').value;
  const duration = document.getElementById('durationSlider').value;

  const classSize = document.getElementById('classSizeSelect').value;
  const standardFocus = document.getElementById('standardInput').value;
  const priorKnowledge = document.getElementById('priorKnowledgeSelect').value;
  const additionalContext = document.getElementById('contextTextarea').value;

  const studentNeeds = [];
  for (let i = 1; i <= 6; i++) {
    const cb = document.getElementById('cb' + i);
    studentNeeds.push(cb ? cb.checked : false);
  }

  if (!topic.trim()) {
    alert('Please enter a lesson topic');
    return;
  }

  // If a file was uploaded, require the 2 descriptive fields
  hideRequiredHints();
  if (inspirationFiles.length > 0) {
    const observed = (inspirationObservedEl?.value || "").trim();
    const goal = (inspirationGoalEl?.value || "").trim();
    if (!observed || !goal) {
      showRequiredHints();
      openInspPanel(true);
      alert("Please describe what you see in the uploaded file (Inspiration Uploads). This helps us build the lesson around it.");
      return;
    }
  }

  let lessonData = {};
  const saved = localStorage.getItem('lessonData');
  if (saved) lessonData = JSON.parse(saved);

  const inspSave = getInspiration();

  lessonData.step1 = {
    grade,
    subject,
    topic,
    state,
    duration: parseInt(duration),
    classSize,
    standardFocus,
    priorKnowledge,
    additionalContext,
    studentNeeds,
    inspiration: inspSave
  };

  localStorage.setItem('lessonData', JSON.stringify(lessonData));
  window.location.href = 'build-step2.html';
}

document.getElementById('durationSlider').addEventListener('input', function(){
  document.getElementById('durationValue').textContent = this.value + ' minutes';
});

const header = document.getElementById('optionalHeader');
const content = document.getElementById('optionalContent');
const icon = document.getElementById('optionalIcon');

header.addEventListener('click', function(e){
  e.stopPropagation();
  content.classList.toggle('show');
  icon.classList.toggle('expanded');
});
content.addEventListener('click', function(e){ e.stopPropagation(); });
</script>
</body>
</html>
