<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon.png">

  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>My Lessons - LessonBuilders</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--navy:#0D2847;--orange:#FF8C42;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:linear-gradient(135deg,#F7FAFC 0%,#FFF 100%);color:#0D2847;}
.top-nav{background:white;border-bottom:2px solid rgba(13,40,71,0.1);padding:16px 40px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.nav-left{display:flex;align-items:center;gap:40px;}
.logo-text{font-family:'Crimson Pro',serif;font-size:24px;font-weight:700;color:var(--navy);text-decoration:none;}
.nav-menu{display:flex;gap:32px;align-items:center;}
.nav-link{text-decoration:none;color:#4A5568;font-weight:500;font-size:15px;transition:color 0.2s;}
.nav-link:hover{color:var(--navy);}
.nav-link.active{color:var(--navy);font-weight:600;}
.nav-right{display:flex;align-items:center;gap:16px;}
.user-profile{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--orange),#FFB380);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:14px;cursor:pointer;}
.content{max-width:1200px;margin:0 auto;padding:40px;}
.page-header{margin-bottom:32px;}
.page-title{font-family:'Crimson Pro',serif;font-size:48px;font-weight:700;color:var(--navy);margin-bottom:8px;}
.page-subtitle{font-size:18px;color:#4A5568;}
.discover-dropzone{background:linear-gradient(135deg,rgba(255,140,66,0.1),rgba(255,179,128,0.1));border:3px dashed var(--orange);border-radius:16px;padding:40px;text-align:center;margin-bottom:32px;transition:all 0.3s;}
.discover-dropzone.drag-over{background:linear-gradient(135deg,rgba(255,140,66,0.2),rgba(255,179,128,0.2));border-color:#FF6B2C;transform:scale(1.02);}
.dropzone-icon{font-size:48px;margin-bottom:12px;}
.dropzone-title{font-size:20px;font-weight:700;color:var(--navy);margin-bottom:8px;}
.dropzone-text{font-size:14px;color:#718096;}
.tab-nav{display:flex;gap:8px;border-bottom:2px solid #E2E8F0;margin-bottom:32px;}
.tab{padding:12px 24px;background:none;border:none;font-size:16px;font-weight:600;color:#4A5568;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all 0.2s;}
.tab.active{color:var(--orange);border-bottom-color:var(--orange);}
.tab:hover:not(.active){color:var(--navy);}
.section-header{margin-bottom:24px;}
.section-title{font-size:24px;font-weight:700;color:var(--navy);margin-bottom:8px;}
.section-subtitle{font-size:14px;color:#718096;}
.folder-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:48px;}
.folder-tile{height:140px;background:white;border:2px solid #E2E8F0;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;position:relative;}
.folder-tile:hover{border-color:var(--orange);box-shadow:0 8px 24px rgba(255,140,66,0.15);transform:translateY(-4px);}
.folder-tile-content{text-align:center;}
.folder-title{font-size:20px;font-weight:700;color:var(--navy);transition:color 0.3s;margin-bottom:4px;}
.folder-count{font-size:14px;color:#718096;transition:color 0.3s;}
.folder-tile:hover .folder-title{color:var(--orange);}
.folder-tile:hover .folder-count{color:var(--orange);}
.grade-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:16px;margin-bottom:48px;}
.grade-tile{height:100px;background:white;border:2px solid #E2E8F0;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;}
.grade-tile:hover{border-color:var(--orange);box-shadow:0 6px 20px rgba(255,140,66,0.15);transform:translateY(-4px);}
.grade-title{font-size:24px;font-weight:700;color:var(--navy);transition:color 0.3s;margin-bottom:4px;}
.grade-count{font-size:13px;color:#718096;transition:color 0.3s;}
.grade-tile:hover .grade-title{color:var(--orange);}
.grade-tile:hover .grade-count{color:var(--orange);}
.lesson-list{display:none;}
.lesson-list.active{display:block;}
.back-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:white;border:2px solid #E2E8F0;border-radius:10px;color:var(--navy);font-weight:600;text-decoration:none;margin-bottom:24px;transition:all 0.2s;}
.back-btn:hover{border-color:var(--orange);}
.lessons-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;margin-top:24px;}
.lesson-card{background:white;border:2px solid #E2E8F0;border-radius:16px;padding:20px;cursor:move;transition:all 0.3s;position:relative;}
.lesson-card:hover{border-color:var(--orange);box-shadow:0 8px 24px rgba(0,0,0,0.08);transform:translateY(-4px);}
.lesson-card.dragging{opacity:0.5;transform:rotate(2deg);}
.lesson-title{font-size:18px;font-weight:700;color:var(--navy);margin-bottom:8px;line-height:1.3;}
.lesson-meta{font-size:14px;color:#718096;margin-bottom:12px;}
.lesson-date{font-size:13px;color:#A0AEC0;}
.lesson-badges{position:absolute;top:12px;right:12px;display:flex;gap:6px;flex-wrap:wrap;}
.collab-badge,.collab-pending,.discover-badge,.discovered-badge{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;}
.collab-badge{background:rgba(16,185,129,0.1);color:#059669;border:1px solid rgba(16,185,129,0.3);}
.collab-pending{background:rgba(251,191,36,0.1);color:#D97706;border:1px solid rgba(251,191,36,0.3);}
.discover-badge{background:rgba(139,92,246,0.1);color:#7C3AED;border:1px solid rgba(139,92,246,0.3);}
.discovered-badge{background:rgba(59,130,246,0.1);color:#2563EB;border:1px solid rgba(59,130,246,0.3);}
.build-section{text-align:center;margin-top:60px;padding-top:40px;border-top:2px solid #E2E8F0;}
.btn-primary{padding:16px 32px;background:linear-gradient(135deg,var(--orange),#FFB380);color:white;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;text-decoration:none;display:inline-block;}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,140,66,0.4);}
@media (max-width:1024px){
  .folder-grid{grid-template-columns:repeat(3,1fr);}
  .grade-grid{grid-template-columns:repeat(4,1fr);}
  .lessons-grid{grid-template-columns:repeat(2,1fr);}
}
@media (max-width:768px){
  .folder-grid{grid-template-columns:repeat(2,1fr);}
  .grade-grid{grid-template-columns:repeat(3,1fr);}
  .lessons-grid{grid-template-columns:1fr;}
}
/* ================================
   Mobile / Tablet responsiveness
   (added by LessonBuilders)
   ================================ */
@media (max-width: 900px){
  .top-nav{padding:12px 16px;flex-wrap:wrap;gap:10px;}
  .nav-left{gap:16px;flex-wrap:wrap;}
  .nav-menu{gap:16px;flex-wrap:wrap;}
  .container{flex-direction:column;max-width:100%;}
  .sidebar{
    width:100%;
    border-right:none;
    border-bottom:1px solid rgba(13,40,71,0.1);
    padding:14px 12px;
    display:flex;
    gap:10px;
    overflow-x:auto;
    -webkit-overflow-scrolling:touch;
  }
  .sidebar > div:first-child{display:none;} /* hide "BUILD LESSON" label on mobile */
  .nav-step{
    flex:0 0 auto;
    margin-bottom:0;
    padding:10px 12px;
    border-left:none;
    border-bottom:3px solid transparent;
    border-radius:10px;
    background:#fff;
    white-space:nowrap;
  }
  .nav-step.active{
    border-bottom-color:var(--orange);
    background:rgba(255,140,66,0.08);
  }
  .nav-step.completed{
    color:var(--green);
  }
  .step-number{flex:0 0 auto;}
  .main-content{padding:22px 16px;max-width:100%;}
  .btn-row{flex-wrap:wrap;gap:10px;}
  .export-group{width:100%;}
  .btn{width:auto;}
}

@media (max-width: 520px){
  .logo-text{font-size:20px;}
  .page-title{font-size:32px;}
  .page-subtitle{font-size:15px;}
  .lesson-title{font-size:22px;}
  .btn-row{flex-direction:column;align-items:stretch;}
  .btn-row .btn{width:100%;}
  .export-group{justify-content:space-between;}
}

</style>
</head>
<body>

<nav class="top-nav">
<div class="nav-left">
<a href="index.html" class="logo-text">LessonBuilders</a>
<div class="nav-menu">
<a href="library.html" class="nav-link active">My Lessons</a>
<a href="discover.html" class="nav-link">Discover</a>
<a href="about.html" class="nav-link">Help</a>
</div>
</div>
<div class="nav-right">
<div class="user-profile">JD</div>
</div>
</nav>

<div class="content">
<div class="page-header">
<h1 class="page-title">My Lessons</h1>
<p class="page-subtitle">Organize and manage your lesson plans</p>
</div>

<!-- Discover Drop Zone -->
<div class="discover-dropzone" id="discoverDropzone">
<div class="dropzone-icon">&#128640;</div>
<div class="dropzone-title">Share to Discover</div>
<div class="dropzone-text">Drag lessons here to share with the community</div>
</div>

<div class="tab-nav">
<button class="tab active" onclick="showTab('subjects')">By Subject</button>
<button class="tab" onclick="showTab('templates')">By Template</button>
<button class="tab" onclick="showTab('grades')">By Grade</button>
</div>

<!-- Subjects View -->
<div id="subjectsView" class="folder-view">
<div class="section-header">
<h2 class="section-title">Organize by Subject</h2>
<p class="section-subtitle">View lessons grouped by subject area</p>
</div>
<div class="folder-grid" id="subjectFolders">
<!-- Populated by JavaScript -->
</div>
</div>

<!-- Templates View -->
<div id="templatesView" class="folder-view" style="display:none;">
<div class="section-header">
<h2 class="section-title">Organize by Template</h2>
<p class="section-subtitle">View lessons grouped by teaching framework</p>
</div>
<div class="folder-grid" id="templateFolders">
<!-- Populated by JavaScript -->
</div>
</div>

<!-- Grades View -->
<div id="gradesView" class="folder-view" style="display:none;">
<div class="section-header">
<h2 class="section-title">Organize by Grade</h2>
<p class="section-subtitle">View lessons grouped by grade level</p>
</div>
<div class="grade-grid" id="gradeFolders">
<!-- Populated by JavaScript -->
</div>
</div>

<!-- Lesson List View -->
<div id="lessonListView" class="lesson-list">
<a href="#" class="back-btn" onclick="backToFolders(); return false;">&larr; Back to Browse</a>
<div class="section-header">
<h2 class="section-title" id="lessonListTitle">Mathematics Lessons</h2>
<p class="section-subtitle" id="lessonListCount">0 lessons</p>
</div>
<div class="lessons-grid" id="lessonCards">
<!-- Populated by JavaScript -->
</div>
</div>

<!-- Build New Lesson -->
<div class="build-section">
<a href="build-step1.html" class="btn-primary">+ Build New Lesson</a>
</div>

</div>

<script>
const subjects = ['Mathematics', 'English Language Arts (ELA)', 'Science', 'Social Studies / History', 'Arts', 'Physical Education', 'Other'];
const templates = [
  { id: 'madeline-hunter', name: 'Madeline Hunter' },
  { id: '5e-model', name: '5E Model' },
  { id: 'ubd', name: 'Understanding by Design' },
  { id: 'gradual-release', name: 'Gradual Release' }
];
const grades = ['Kindergarten', '1st Grade', '2nd Grade', '3rd Grade', '4th Grade', '5th Grade', '6th Grade', '7th Grade', '8th Grade', '9th Grade', '10th Grade', '11th Grade', '12th Grade'];

let allLessons = [];
let currentFilter = '';
let currentFilterName = '';

window.addEventListener('DOMContentLoaded', function() {
  const saved = localStorage.getItem('savedLessons');
  if (saved) {
    allLessons = JSON.parse(saved);
  }
  
  renderSubjectFolders();
  renderTemplateFolders();
  renderGradeFolders();
});

function countByKey(key, value) {
  return allLessons.filter(l => {
    if (key === 'subject') return l.subject === value;
    if (key === 'framework') return l.framework === value;
    if (key === 'grade') return l.grade === value;
    return false;
  }).length;
}

function renderSubjectFolders() {
  const container = document.getElementById('subjectFolders');
  container.innerHTML = subjects.map(subject => {
    const count = countByKey('subject', subject);
    return `
      <div class="folder-tile" onclick="showLessons('subject', '${subject}')">
        <div class="folder-tile-content">
          <div class="folder-title">${subject.split('/')[0]}</div>
          <div class="folder-count">${count} lesson${count !== 1 ? 's' : ''}</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderTemplateFolders() {
  const container = document.getElementById('templateFolders');
  container.innerHTML = templates.map(template => {
    const count = countByKey('framework', template.id);
    return `
      <div class="folder-tile" onclick="showLessons('framework', '${template.id}')">
        <div class="folder-tile-content">
          <div class="folder-title">${template.name}</div>
          <div class="folder-count">${count} lesson${count !== 1 ? 's' : ''}</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderGradeFolders() {
  const container = document.getElementById('gradeFolders');
  container.innerHTML = grades.map(grade => {
    const count = countByKey('grade', grade);
    const shortGrade = grade === 'Kindergarten' ? 'K' : grade.replace(/(\d+)(st|nd|rd|th)/, '$1');
    return `
      <div class="grade-tile" onclick="showLessons('grade', '${grade}')">
        <div class="grade-title">${shortGrade}</div>
        <div class="grade-count">${count} lesson${count !== 1 ? 's' : ''}</div>
      </div>
    `;
  }).join('');
}

function showTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  
  document.getElementById('subjectsView').style.display = tab === 'subjects' ? 'block' : 'none';
  document.getElementById('templatesView').style.display = tab === 'templates' ? 'block' : 'none';
  document.getElementById('gradesView').style.display = tab === 'grades' ? 'block' : 'none';
  document.getElementById('lessonListView').classList.remove('active');
}

function showLessons(filterType, filterValue) {
  currentFilter = filterType;
  currentFilterName = filterValue;
  
  document.getElementById('subjectsView').style.display = 'none';
  document.getElementById('templatesView').style.display = 'none';
  document.getElementById('gradesView').style.display = 'none';
  
  document.getElementById('lessonListView').classList.add('active');
  
  const displayName = filterType === 'framework' 
    ? templates.find(t => t.id === filterValue)?.name || filterValue
    : filterValue;
  
  document.getElementById('lessonListTitle').textContent = displayName + ' Lessons';
  
  let filteredLessons = allLessons.filter(l => {
    if (filterType === 'subject') return l.subject === filterValue;
    if (filterType === 'framework') return l.framework === filterValue;
    if (filterType === 'grade') return l.grade === filterValue;
    return false;
  });
  
  const count = filteredLessons.length;
  document.getElementById('lessonListCount').textContent = count + (count === 1 ? ' lesson' : ' lessons');
  
  const container = document.getElementById('lessonCards');
  if (filteredLessons.length === 0) {
    container.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:60px 20px;color:#718096;">No lessons in this category yet. <a href="build-step1.html" style="color:var(--orange);text-decoration:none;font-weight:600;">Build your first lesson &rarr;</a></div>';
  } else {
    container.innerHTML = filteredLessons.map(lesson => {
      const date = new Date(lesson.savedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const badges = [];
      if (lesson.hasCollaborations) badges.push('<div class="collab-badge">Collaborated</div>');
      if (lesson.collaborationPending) badges.push('<div class="collab-pending">Pending...</div>');
      if (lesson.sharedToDiscover) badges.push('<div class="discover-badge">Discover</div>');
      if (lesson.discoveredFrom) badges.push('<div class="discovered-badge">Discovered</div>');
      const badgesHTML = badges.length > 0 ? `<div class="lesson-badges">${badges.join('')}</div>` : '';
      
      return `
        <div class="lesson-card" draggable="true" data-lesson-id="${lesson.id}">
          ${badgesHTML}
          <div class="lesson-title">${lesson.title}</div>
          <div class="lesson-meta">${lesson.grade} &bull; ${lesson.subject.split('/')[0]} &bull; ${lesson.duration} min</div>
          <div class="lesson-date">${date}</div>
        </div>
      `;
    }).join('');
    attachDragListeners();
  }
}

function backToFolders() {
  document.getElementById('lessonListView').classList.remove('active');
  
  const activeTab = document.querySelector('.tab.active').textContent.toLowerCase();
  if (activeTab.includes('subject')) {
    document.getElementById('subjectsView').style.display = 'block';
  } else if (activeTab.includes('template')) {
    document.getElementById('templatesView').style.display = 'block';
  } else if (activeTab.includes('grade')) {
    document.getElementById('gradesView').style.display = 'block';
  }
}

// Drag and Drop functionality
let draggedLessonId = null;

function attachDragListeners() {
  const cards = document.querySelectorAll('.lesson-card[draggable="true"]');
  cards.forEach(card => {
    card.addEventListener('click', function(e) {
      if (!this.classList.contains('dragging')) {
        window.location.href = 'lesson-view.html?id=' + this.dataset.lessonId;
      }
    });
    
    card.addEventListener('dragstart', function(e) {
      draggedLessonId = this.dataset.lessonId;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
    
    card.addEventListener('dragend', function() {
      this.classList.remove('dragging');
    });
  });
}

const dropzone = document.getElementById('discoverDropzone');
if (dropzone) {
  dropzone.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('drag-over');
  });
  
  dropzone.addEventListener('dragleave', function() {
    this.classList.remove('drag-over');
  });
  
  dropzone.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('drag-over');
    
    if (draggedLessonId) {
      const saved = localStorage.getItem('savedLessons');
      if (saved) {
        let lessons = JSON.parse(saved);
        const lesson = lessons.find(l => l.id == draggedLessonId);
        if (lesson && !lesson.sharedToDiscover) {
          lesson.sharedToDiscover = true;
          localStorage.setItem('savedLessons', JSON.stringify(lessons));
          alert('Lesson shared to Discover!');
          location.reload();
        } else if (lesson && lesson.sharedToDiscover) {
          alert('This lesson is already shared to Discover');
        }
      }
      draggedLessonId = null;
    }
  });
}
</script>

</body>
</html>
