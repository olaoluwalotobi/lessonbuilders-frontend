<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Assessments - LessonBuilders</title>

  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{--navy:#0D2847;--orange:#FF8C42;--green:#10B981;--yellow:#F59E0B;--red:#EF4444;--blue:#3B82F6;}
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'DM Sans',sans-serif;background:linear-gradient(135deg,#F7FAFC 0%,#FFF 100%);color:#0D2847;}

    /* Top nav (match Step 6 vibe) */
    .top-nav{
      background:white;border-bottom:2px solid rgba(13,40,71,0.1);
      padding:16px 40px;display:flex;justify-content:space-between;align-items:center;
      position:sticky;top:0;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .nav-left{display:flex;align-items:center;gap:40px;}
    .logo-text{font-family:'Crimson Pro',serif;font-size:24px;font-weight:700;color:var(--navy);text-decoration:none;}
    .nav-menu{display:flex;gap:32px;align-items:center;}
    .nav-link{text-decoration:none;color:#4A5568;font-weight:600;font-size:15px;transition:color 0.2s;}
    .nav-link:hover{color:var(--navy);}
    .nav-link.active{color:var(--navy);}

    .nav-right{display:flex;align-items:center;gap:16px;}
    .user-profile{
      width:36px;height:36px;border-radius:50%;
      background:linear-gradient(135deg,var(--orange),#FFB380);
      display:flex;align-items:center;justify-content:center;color:white;
      font-weight:700;font-size:14px;cursor:default;
    }

    /* Layout */
    .container{display:flex;max-width:1400px;margin:0 auto;}
    .sidebar{
      width:280px;background:white;border-right:1px solid rgba(13,40,71,0.1);
      padding:30px 20px;
    }
    .sidebar-title{
      font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:0.5px;color:#999;margin-bottom:16px;
    }

    /* Sidebar items (closer to Step 1–7 vibe, but “Assessments” only) */
    .side-item{
      display:flex;align-items:center;gap:12px;
      padding:12px;margin-bottom:10px;border-left:3px solid transparent;
      border-radius:12px;color:#4A5568;cursor:pointer;user-select:none;
      transition:all 0.2s;
    }
    .side-item:hover{background:rgba(13,40,71,0.03);color:var(--navy);}
    .side-item.active{
      background:rgba(255,140,66,0.10);
      border-left-color:var(--orange);
      color:var(--navy);
      font-weight:800;
    }
    .side-icon{
      width:28px;height:28px;border-radius:50%;
      background:#F7FAFC;border:2px solid #E2E8F0;
      display:flex;align-items:center;justify-content:center;
      font-size:13px;font-weight:800;color:#999;
      flex:0 0 auto;
    }
    .side-item.active .side-icon{
      background:var(--orange);border-color:var(--orange);color:#fff;
    }

    /* Main */
    .main{flex:1;padding:40px 60px;max-width:980px;}
    .page-title{font-family:'Crimson Pro',serif;font-size:44px;font-weight:700;margin-bottom:10px;color:var(--navy);}
    .page-subtitle{font-size:16px;color:#4A5568;margin-bottom:14px;max-width:760px;line-height:1.5;}

    /* Thin orange line like your reference */
    .progress-line{
      height:4px;background:#E2E8F0;border-radius:3px;margin-bottom:22px;overflow:hidden;max-width:860px;
    }
    .progress-line > div{
      height:100%;width:54%;
      background:linear-gradient(90deg,var(--orange),#FFB380);
      border-radius:3px;
    }

    /* Main card */
    .card{
      background:white;border:2px solid #E2E8F0;border-radius:16px;
      padding:18px;max-width:860px;
    }
    .card-grid{
      display:grid;
      grid-template-columns: 1fr 200px; /* left form + right type buttons */
      gap:18px;
      align-items:start;
    }
    .card-title{font-size:18px;font-weight:800;color:var(--navy);margin-bottom:4px;}
    .card-sub{font-size:13px;color:#718096;margin-bottom:14px;}

    .field-label{
      font-size:12px;font-weight:900;letter-spacing:.2px;text-transform:uppercase;
      color:#718096;margin:10px 0 8px;
    }

    /* Dropdown */
    .select-wrap{position:relative;}
    select{
      width:100%;
      border:2px solid #E2E8F0;
      border-radius:12px;
      padding:12px 40px 12px 14px;
      font-size:15px;font-weight:600;color:var(--navy);
      background:white;outline:none;
      appearance:none;
    }
    .select-wrap:after{
      content:"▾";
      position:absolute;right:14px;top:50%;
      transform:translateY(-50%);
      color:#8A95A5;font-weight:900;
      pointer-events:none;
    }
    select:focus{
      border-color:rgba(255,140,66,0.8);
      box-shadow:0 0 0 4px rgba(255,140,66,0.12);
    }

    /* Teacher notes textarea: wraps + auto height (no side-scroll) */
    textarea{
      width:100%;
      border:2px solid #E2E8F0;
      border-radius:12px;
      padding:12px 14px;
      font-size:15px;
      font-family:'DM Sans',sans-serif;
      color:var(--navy);
      line-height:1.45;

      resize:none;            /* you said auto-height is better */
      overflow:hidden;        /* no scrollbars; height grows */
      white-space:pre-wrap;   /* wraps lines */
      word-break:break-word;  /* long words don’t force horizontal scroll */
      min-height:84px;
      outline:none;
    }
    textarea:focus{
      border-color:rgba(255,140,66,0.8);
      box-shadow:0 0 0 4px rgba(255,140,66,0.12);
    }
    .tip{font-size:12px;color:#718096;margin-top:8px;}

    /* Right side assessment type */
    .type-title{
      font-size:12px;font-weight:900;letter-spacing:.2px;text-transform:uppercase;
      color:#718096;margin-top:2px;margin-bottom:10px;text-align:right;
    }
    .type-btn{
      width:100%;
      border:2px solid #E2E8F0;
      border-radius:999px;
      padding:10px 10px;
      font-size:14px;
      font-weight:800;
      background:white;
      color:var(--navy);
      cursor:pointer;
      transition:all .18s;
      margin-bottom:10px;
    }
    .type-btn:hover{border-color:rgba(255,140,66,0.55);}
    .type-btn.active{
      border-color:rgba(255,140,66,0.9);
      background:rgba(255,140,66,0.12);
    }

    /* Bottom buttons: Clear left, Generate right */
    .card-actions{
      display:flex;align-items:center;gap:12px;margin-top:16px;
    }
    .btn{
      padding:12px 18px;border-radius:12px;font-size:14px;font-weight:900;
      cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;border:none;
    }
    .btn-secondary{background:white;border:2px solid #E2E8F0;color:var(--navy);}
    .btn-secondary:hover{border-color:rgba(255,140,66,0.55);}
    .btn-primary{
      background:linear-gradient(135deg,var(--orange),#FFB380);
      color:white;
      box-shadow:0 10px 20px rgba(255,140,66,0.20);
    }
    .btn-primary:hover{transform:translateY(-1px);}
    .spacer{flex:1;}

    /* Upload section card (kept but hidden until tab is clicked) */
    .upload-card{margin-top:14px;max-width:860px;}
    .file-box{
      border:2px dashed rgba(13,40,71,0.18);
      border-radius:12px;padding:12px;background:rgba(13,40,71,0.02);
    }
    input[type="file"]{width:100%;}
    .small-note{font-size:12px;color:#718096;margin-top:8px;}

    /* Responsive */
    @media (max-width: 980px){
      .top-nav{padding:12px 16px;flex-wrap:wrap;gap:10px;}
      .nav-left{gap:16px;flex-wrap:wrap;}
      .container{flex-direction:column;max-width:100%;}
      .sidebar{
        width:100%;
        border-right:none;border-bottom:1px solid rgba(13,40,71,0.1);
        padding:14px 12px;
        display:flex;gap:10px;overflow-x:auto;-webkit-overflow-scrolling:touch;
      }
      .sidebar-title{display:none;}
      .side-item{flex:0 0 auto;margin-bottom:0;border-left:none;border-bottom:3px solid transparent;}
      .side-item.active{border-bottom-color:var(--orange);border-left-color:transparent;}
      .main{padding:22px 16px;max-width:100%;}
      .card-grid{grid-template-columns:1fr;}
      .type-title{text-align:left;margin-top:10px;}
    }
  </style>
</head>

<body>
  <nav class="top-nav">
    <div class="nav-left">
      <a href="index.html" class="logo-text">LessonBuilders</a>
      <div class="nav-menu">
        <a href="library.html" class="nav-link">My Lessons</a>
        <a href="assessments.html" class="nav-link active">Assessments</a>
        <a href="discover.html" class="nav-link">Discover</a>
        <a href="about.html" class="nav-link">Help</a>
      </div>
    </div>
    <div class="nav-right">
      <div class="user-profile" id="userProfile">LB</div>
    </div>
  </nav>

  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-title">ASSESSMENTS</div>

      <div class="side-item active" id="tabCreate" onclick="showTab('create')">
        <div class="side-icon">A</div>
        <div style="font-weight:800;">Create from Lesson</div>
      </div>

      <div class="side-item" id="tabUpload" onclick="showTab('upload')">
        <div class="side-icon">↑</div>
        <div style="font-weight:800;">Upload Existing</div>
      </div>
    </aside>

    <main class="main">
      <h1 class="page-title">Assessments</h1>
      <p class="page-subtitle">Create classroom-ready assessments from your lessons — or upload what you already have and enhance it.</p>
      <div class="progress-line"><div></div></div>

      <!-- CREATE -->
      <section id="createSection">
        <div class="card">
          <div class="card-grid">
            <div>
              <div class="card-title">Create from a lesson</div>
              <div class="card-sub">Choose a saved lesson (or your current build) and generate an assessment draft.</div>

              <div class="field-label">Select lesson</div>
              <div class="select-wrap">
                <select id="lessonSelect"></select>
              </div>

              <div class="field-label" style="margin-top:16px;">Teacher notes (optional)</div>
              <textarea id="teacherNotes" placeholder="Ex: focus on vocabulary + guided practice outcomes"></textarea>
              <div class="tip">Tip: Use this to steer difficulty, format, or focus.</div>
            </div>

            <div>
              <div class="type-title">ASSESSMENT TYPE</div>

              <button class="type-btn active" data-type="Quiz" onclick="setType('Quiz')">Quiz</button>
              <button class="type-btn" data-type="Exit Ticket" onclick="setType('Exit Ticket')">Exit Ticket</button>
              <button class="type-btn" data-type="In-Class Activity" onclick="setType('In-Class Activity')">In-Class Activity</button>
              <button class="type-btn" data-type="Homework Assignment" onclick="setType('Homework Assignment')">Homework Assignment</button>
            </div>
          </div>

          <div class="card-actions">
            <button class="btn btn-secondary" onclick="clearCreate()">Clear</button>
            <div class="spacer"></div>
            <button class="btn btn-primary" onclick="generateDraft()">Generate Draft</button>
          </div>
        </div>
      </section>

      <!-- UPLOAD -->
      <section id="uploadSection" style="display:none;">
        <div class="card upload-card">
          <div class="card-title">Upload existing</div>
          <div class="card-sub">Upload an assessment you already have and enhance it.</div>

          <div class="field-label">Upload file (PDF/DOC/TXT)</div>
          <div class="file-box">
            <input type="file" id="uploadFile" />
            <div class="small-note">For now, this page can store the file selection. When you connect backend processing, you can extract text and generate studentCopy/answerKey/rubric.</div>
          </div>

          <div class="field-label" style="margin-top:16px;">Or paste assessment text</div>
          <textarea id="uploadText" placeholder="Paste your assessment here..."></textarea>

          <div class="card-actions">
            <button class="btn btn-secondary" onclick="clearUpload()">Clear</button>
            <div class="spacer"></div>
            <button class="btn btn-primary" onclick="enhanceUpload()">Enhance</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    /* ===== UI behavior only (keeps your layout exact) ===== */

    // ---- user bubble initials (optional)
    (function(){
      function initialsFromEmail(email) {
        if (!email) return "LB";
        const namePart = String(email).split("@")[0] || "";
        const tokens = namePart.split(/[.\-_]/).filter(Boolean);
        const a = tokens[0]?.[0] || "";
        const b = tokens[1]?.[0] || tokens[0]?.[1] || "";
        return (a + b).toUpperCase() || "LB";
      }
      const el = document.getElementById("userProfile");
      if (!el) return;
      try{
        const raw = localStorage.getItem("lb_user") || localStorage.getItem("user") || "";
        if (!raw) return;
        const u = JSON.parse(raw);
        el.textContent = initialsFromEmail(u?.email || u?.user?.email);
      } catch {}
    })();

    // ---- auto-height textarea (wrap + grow down)
    function autoGrow(el){
      el.style.height = "auto";
      el.style.height = el.scrollHeight + "px";
    }
    document.addEventListener("input", (e) => {
      if (e.target && e.target.tagName === "TEXTAREA") autoGrow(e.target);
    });
    window.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("textarea").forEach(autoGrow);
    });

    // ---- tabs
    function showTab(which){
      const create = document.getElementById("createSection");
      const upload = document.getElementById("uploadSection");
      const tabCreate = document.getElementById("tabCreate");
      const tabUpload = document.getElementById("tabUpload");

      if (which === "upload"){
        create.style.display = "none";
        upload.style.display = "block";
        tabCreate.classList.remove("active");
        tabUpload.classList.add("active");
      } else {
        create.style.display = "block";
        upload.style.display = "none";
        tabUpload.classList.remove("active");
        tabCreate.classList.add("active");
      }
    }
    window.showTab = showTab;

    // ---- lesson dropdown (uses your savedLessons + current lessonData if present)
    function safeParse(s){ try{return JSON.parse(s);}catch{return null;} }

    function summarizeLesson(obj){
      const title = obj?.title || obj?.step1?.topic || "Untitled Lesson";
      const grade = obj?.grade || obj?.step1?.grade || "";
      const subject = obj?.subject || obj?.step1?.subject || "";
      const parts = [];
      if (grade) parts.push(grade);
      if (subject) parts.push(subject);
      return parts.length ? `${title} (${parts.join(" • ")})` : title;
    }

    function loadLessons(){
      const results = [];

      const ldRaw = localStorage.getItem("lessonData");
      const lessonData = ldRaw ? (safeParse(ldRaw) || null) : null;
      if (lessonData?.step1?.topic){
        results.push({ id:"current-build", label: summarizeLesson(lessonData) + " — Current Build" });
      }

      const savedRaw = localStorage.getItem("savedLessons");
      const saved = savedRaw ? (safeParse(savedRaw) || []) : [];
      if (Array.isArray(saved)){
        saved.forEach(s => {
          results.push({ id: String(s.id || Date.now()), label: summarizeLesson(s) });
        });
      }

      if (!results.length){
        results.push({ id:"none", label:"No saved lessons yet — build a lesson first" });
      }

      const sel = document.getElementById("lessonSelect");
      sel.innerHTML = results.map(r => `<option value="${r.id}">${r.label}</option>`).join("");
    }

    // ---- assessment type selection
    let selectedType = "Quiz";
    function setType(type){
      selectedType = type;
      document.querySelectorAll(".type-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-type") === type);
      });
    }
    window.setType = setType;

    // ---- actions (placeholders; you’ll wire to backend later)
    function clearCreate(){
      const t = document.getElementById("teacherNotes");
      t.value = "";
      autoGrow(t);
    }
    window.clearCreate = clearCreate;

    function generateDraft(){
      // UI-only stub: keep layout; replace later with backend call
      alert("Generate Draft clicked (" + selectedType + ").\n\nNext step: connect this to your assessment-generation endpoint.");
    }
    window.generateDraft = generateDraft;

    function clearUpload(){
      const u = document.getElementById("uploadText");
      const f = document.getElementById("uploadFile");
      u.value = "";
      if (f) f.value = "";
      autoGrow(u);
    }
    window.clearUpload = clearUpload;

    function enhanceUpload(){
      alert("Enhance clicked.\n\nNext step: connect upload processing to backend.");
    }
    window.enhanceUpload = enhanceUpload;

    // init
    window.addEventListener("DOMContentLoaded", loadLessons);
  </script>
</body>
</html>
